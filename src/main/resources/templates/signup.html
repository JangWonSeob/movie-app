<!DOCTYPE html>
<html lang="kr">
<head>
    <meta charset="UTF-8">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <title>회원가입 페이지</title>
</head>
<body>
<h1>회원 가입</h1>
<hr>
<form id="signup_form" action="/user/signup" method="post">
    <input type="text" id="email" name="email" placeholder="이메일 입력"><br>
    <span id="emailChk" class="doubleChk">인증번호 보내기</span><br/>
    <input id="certified" type="text" name="certified" title="인증번호 입력" disabled required/> <br>
    <span id="emailChk2" class="doubleChk">이메일인증</span><br>
    <span class="point successEmailChk">이메일 입력후 인증번호 보내기를 해주십시오.</span> <br>
    <input type="hidden" id="emailDoubleChk"/>
    <input type="password" id="userpass" name="password" placeholder="비밀번호" required minlength="8" autocomplete="off">
    <span class="point">※ 비밀번호는 8자이상만 가능</span>
    <br>
    <input type="password" id="userpasschk" name="passwordchk" placeholder="비밀번호확인" required minlength="8" autocomplete="off"/>
    <span class="point successPwChk"></span>
    <input type="hidden" id="pwDoubleChk"/><br>
    <input type="text" name="name" placeholder="본명"><br>
    <input type="text" id="nickname" name="nickname" placeholder="닉네임"><br>
    <button type="submit" id="button1">가입하기</button><br>
</form>


<script type="text/javascript">
    //이메일 인증
    var code = "";
    $("#emailChk").click(function(){
        var email = $("#email").val();
        $.ajax({
            type:"GET",
            url:"/user/mailCheck?email=" + email,
            cache : false,
            success:function(data){
                if(data == "error"){
                    alert("이메일 주소가 올바르지 않습니다. 유효한 이메일 주소를 입력해주세요.");
                    $("#email").attr("autofocus",true);
                    $(".successEmailChk").text("유효한 이메일 주소를 입력해주세요.");
                    $(".successEmailChk").css("color","red");
                }else{
                    alert("인증번호 발송이 완료되었습니다.\n입력한 이메일에서 인증번호 확인을 해주십시오.");
                    $("#certified").attr("disabled",false);
                    $("#emailChk2").css("display","inline-block");
                    $(".successEmailChk").text("인증번호를 입력한 뒤 이메일 인증을 눌러주십시오.");
                    $(".successEmailChk").css("color","green");
                    code = data;
                }
            }
        });
    });
    //이메일 인증번호 대조
    $("#emailChk2").click(function(){
        console.log(code);
        console.log(typeof code);
        if($("#certified").val() == code) {
            $(".successEmailChk").text("인증번호가 일치합니다.");
            $(".successEmailChk").css("color","green");
            $("#emailDoubleChk").val("true");
            $("#certified").attr("disabled",true);
            //$("#email").attr("disabled",true);
        }else{
            $(".successEmailChk").text("인증번호가 일치하지 않습니다. 확인해주시기 바랍니다.");
            $(".successEmailChk").css("color","red");
            $("#emailDoubleChk").val("false");
            $("#certified").attr("autofocus",true);
        }
    });
    //비밀번호 확인
    $("#userpasschk").blur(function(){
        if($("#userpasschk").val() == $("#userpass").val()){
            $(".successPwChk").text("비밀번호가 일치합니다.");
            $(".successPwChk").css("color", "green");
            $("#pwDoubleChk").val("true"); }else{
            $(".successPwChk").text("비밀번호가 일치하지 않습니다.");
            $(".successPwChk").css("color", "red");
            $("#pwDoubleChk").val("false"); } }
    );
    //최종 틍록하기 버튼 클릭시 각 부분별 입력값 맞는지 확인
    $("#button1").click(function(){
        if($("#pwDoubleChk").val() == "true" && $("#emailDoubleChk").val() == "true")
        {
            alert($('#nickname').val()+"님 환영합니다. :)");
        }else{
            alert("회원가입을 완료할 수 없습니다. 다시한번 확인해주십시오.");
            if($("#pwDoubleChk").val() != "true"){
                $(".successPwChk").text("비밀번호가 일치하지 않습니다 :)");
                $(".successPwChk").css("color", "red"); }
            if($("#emailDoubleChk").val() != "true"){
                $(".successEmailChk").text("이메일 인증을 완료해주세요 :)");
                $(".successEmailChk").css("color", "red");
            }
            return false
        }
    });

</script>
</body>
</html>


