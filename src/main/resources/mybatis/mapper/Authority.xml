<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.website.movie.biz.dao.AuthorityDao">
    <sql id="TABLE">authority</sql>

    <select id="select" parameterType="int" resultType="String">
        SELECT AUTHORITY_NAME FROM <include refid="TABLE"/> WHERE ID = #{id}
    </select>

    <select id="selectByEmail" parameterType="String" resultType="String">
        SELECT AUTHORITY_NAME FROM <include refid="TABLE"/> WHERE EMAIL = #{email}
    </select>

    <!--권한부여-->
    <insert id="insertAuthority"
            parameterType="org.springframework.security.core.GrantedAuthority">
        INSERT INTO <include refid="TABLE"/>(ID, AUTHORITY_NAME, EMAIL,REG_DT)
        VALUES
        <foreach item="item" collection="authorities" separator=",">
            ((SELECT AUTO_INCREMENT
            FROM information_schema.tables
            WHERE table_name = 'user'
            AND table_schema = DATABASE())-1, #{item.authority}, #{email},NOW())
        </foreach>
    </insert>

    <delete id="deleteAuthority" parameterType="int">
        DELETE FROM authority WHERE ID = #{id}
    </delete>


</mapper>